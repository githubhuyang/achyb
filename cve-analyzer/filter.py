#!/usr/bin/env python
# -*- coding: utf-8 -*-

""" CVE filters (remove CVEs which we do not want) """

import os
import json
from const import *
from kv import *
from kfp import *


def remove_nokv_cases(cveinfo_lst):
    ''' remove CVEs whose kernel versions are unknown '''
    return [cveinfo for cveinfo in cveinfo_lst if cveinfo["kernel_version"] is not None]


def remove_low_kv_cases(cveinfo_lst, v="2.6"):
    ''' remove CVEs whose kernel versions are older than v (default 2.6) '''
    return [cveinfo for cveinfo in cveinfo_lst if vsmaller(v, cveinfo["kernel_version"])]


def remove_vendor_cases(cveinfo_lst):
    ''' remove CVEs in vendor-customized verions '''
    main_cveinfo_lst = []
    for cveinfo in cveinfo_lst:
        s = cveinfo["summary"].lower()
        if "red hat" in s or " ubuntu" in s or "openvz" in s:
            continue
        main_cveinfo_lst.append(cveinfo)

    return main_cveinfo_lst


def remove_nodiff_cases(cveinfo_lst):
    ''' remove CVEs without diff info '''
    return [cveinfo for cveinfo in cveinfo_lst if cveinfo["diff"] is not None]


def remove_nokfp_cases(cveinfo_lst):
    ''' remove CVEs without file path '''
    return [cveinfo for cveinfo in cveinfo_lst if cveinfo["file_path"] is not None]


def remove_noneexp_cases(cveinfo_lst):
    ''' remove CVEs without exploits '''
    return [cveinfo for cveinfo in cveinfo_lst if cveinfo["exploit"] is not None]
